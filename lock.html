<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
<style>
  body {
    background-color: #FEFEFE;
    font: #222;
    font-size: 18px;
    margin: 40px;
    font-family: Helvetica;
  }
</style>
</head>

<body>
  <div>CONSOLE LOG <button id="clear">Clear</button></div>
  <pre id="output"></pre>
  <script>
var getSeconds = function getSeconds() {
  return Math.round(Date.now() / 1000);
};

function padLeft(nr, n, str) {
  return Array(n - String(nr).length + 1).join(str || '0') + nr;
}

var start = getSeconds();

var getTimestamp = function getTimestamp() {
  var seconds = getSeconds() - start;
  var mins = Math.floor(seconds / 60);
  var secs = seconds % 60;
  var pad = "00";
  return "".concat(padLeft(mins, 2), ":").concat(padLeft(secs, 2));
};

var output = document.getElementById("output");
var button = document.getElementById("clear");

button.onclick = function () {
  while (output.firstChild) {
    output.removeChild(output.lastChild);
  }
};

var debug = function debug(msg) {
  var message = document.createElement("div");
  message.innerText = "+".concat(getTimestamp(), " ").concat(msg);
  output.appendChild(message);
};

debug("Page has loaded");
var hidden = "";
var visibilityChange = "";

if ("hidden" in document) {
  hidden = "hidden";
  visibilityChange = "visibilitychange";
} else if ("msHidden" in document) {
  hidden = "msHidden";
  visibilityChange = "msvisibilitychange";
} else if ("webkitHidden" in document) {
  hidden = "webkitHidden";
  visibilityChange = "webkitvisibilitychange";
}

var isTabActive = true;

if (hidden !== "" && visibilityChange !== "") {
  debug("Using visibility change event");
  document.addEventListener(visibilityChange, function () {
    if (document[hidden]) {
      debug("Document Visibility Change: Hidden");
      isTabActive = false;
    } else {
      debug("Document Visiblity Change: Visible");
      isTabActive = true;
    }

    documentVisibilityChange.fire(isTabActive);
  });
} else {
  debug("Falling back to blur/focus"); // Use window blur/focus events as fallback for document.hidden
}

window.addEventListener("blur", function () {
  isTabActive = false;
  debug("Document blurred");
  documentVisibilityChange.fire(isTabActive);
});
window.addEventListener("focus", function () {
  isTabActive = true;
  debug("Document Focused");
  documentVisibilityChange.fire(isTabActive);
});
window.addEventListener("pagehide", function () {
  isTabActive = false;
  debug("Page Hidden");
});
window.addEventListener("pageshow", function () {
  isTabActive = true;
  debug("Page Shown");
});
  </script>
</body>
</html>
